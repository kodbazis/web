<div class="mt-3 mb-3 content-body">
	<div class="col-sm-12">
		<div class="card">
			<div class="card-body">
				<div class="card-title">
					<h1 class="mb-4 mt-5">{{ episode.title }}</h1>
				</div>
				<hr>
				{{ episodeContent | raw }}
				<hr class="mb-3">
			</div>
			<form id="form" class="mb-3 bg-light p-3" data-episodeid="{{episode.id}}">
				<h2>
					Neked miben segít a kurzus?
				</h2>
				<h4 class="text-center lead mb-2">
					Kérjük, írd le pár szóban!
				</h4>
				<div class="form-group row pb-3">
					<label class="col-sm-2 col-form-label">Név/Becenév:</label>
					<div class="col-md-10">
						<input type="text" name="name" class="form-control" required/>
					</div>
				</div>
				<div class="form-group row pb-3">
					<label class="col-sm-2 col-form-label">Tartalom:</label>
					<div class="col-md-10">
						<textarea rows="3" type="text" name="content" class="form-control" required></textarea>
					</div>
				</div>

				<button id="submit-btn" type="submit" class="btn btn-success">
					Küldés
				</button>
			</form>

			<div script="form-container" class="mb-3"></div>
			<div>
				<h2 class="pt-3 pb-2 text-center bg-light">További epizódok:</h2>
				<div class="app mb-3 bg-light" data-position="{{episode.position}}">
					<ul class="hs full">
						{% for ep in allEpisodesInCourse %}
							<a href="/react-kurzus/{{ep.slug}}">
								<li class="item {{ep.id == episode.id ? 'selected-episode' : ''}}">
									{% if ep.imgUrl %}
										<img class="img-thumbnail" src="/public/files/sm-{{ep.imgUrl}}"/>
									{% else %}
										<p class="text-center">{{ ep.title }}</p>
									{% endif %}
								</li>
							</a>
						{% endfor %}
					</ul>
				</div>

				<div class="row ml-2 mr-2">
					<div class="col-sm-6 mb-3">
						{% if previousEpisode %}
							<a href="/react-kurzus/{{previousEpisode.slug}}">
								<button class="btn btn-success w-100">
									<span class="lead">←</span>
									{{previousEpisode.title}}
								</button>
							</a>
						{% endif %}
					</div>
					<div class="col-sm-6">
						{% if nextEpisode %}
							<a class="float-right" href="/react-kurzus/{{nextEpisode.slug}}">
								<button class="btn btn-success w-100">
									{{nextEpisode.title}}
									<span class="lead">→</span>
								</button>
							</a>
						{% else %}
							<h2>Következő rész hamarosan...</h2>
						{% endif %}
					</div>
				</div>

				<div id="fb-root"></div>
			</div>
			<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v8.0&appId=705894336804251&autoLogAppEvents=1" nonce="GLaxzOjV"></script>
			<div class="fb-like" data-href="{{url}}" data-width="" data-layout="standard" data-action="like" data-size="small" data-share="true"></div>
		</div>
	</div>
</div>

<script>
	const pos = parseInt(document.querySelector('.app').dataset.position) - 2;
const epWidth = document.querySelector('.item').offsetWidth + 10;
document.querySelector('.hs').scrollLeft = epWidth * pos;


const form = document.getElementById("form");
form.onchange = function (e) {
const name = form.elements.name.value;
const content = form.elements.content.value;
};

form.onsubmit = async function (e) {
e.preventDefault();
const name = e.target.elements.name.value;
const content = e.target.elements.content.value;
const episodeId = form.dataset.episodeid;

form.innerHTML = `
    <h1 class='text-success mt-5 mb-5'>
        Küldés folyamatban...
        <div class="spinner-border text-success font-weight-normal" role="status">
            <span class="sr-only">Küldés folyamatban...</span>
        </div>
    </h1>
    `;

const res = await fetch("/api/feedbacks", {
method: "post",
body: JSON.stringify(
{name, content, episodeId}
)
});
form.innerHTML = `<h1 class='text-success mt-5 mb-5'>Köszönjük a visszajelzést!</h1>`;
};
</script>
